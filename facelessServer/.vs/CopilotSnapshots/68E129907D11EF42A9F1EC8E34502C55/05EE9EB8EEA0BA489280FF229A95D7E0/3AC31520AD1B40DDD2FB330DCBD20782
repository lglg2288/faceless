using Grpc.Core;
using System;
using System.Threading.Tasks;
using static MessServiceApp.SenderIDService;

namespace MessServiceApp
{
    // Implementation of the gRPC service defined in Protos/auth.proto
    // The generated code provides a base class `SenderID.SenderIDBase` which
    // we inherit from and override RPC methods on.
    public class SenderIDService : SenderID.SenderIDBase
    {
        public delegate ulong _OnUsernameReceived(string username);
        public event _OnUsernameReceived? OnUsernameReceived;
        // Simple example implementation: generate an id based on current UTC milliseconds.
        // In real world you would use a database, sequence, or other persistent store.
        public override async Task<Response> GetID(Request request, ServerCallContext context)
        {
            ulong id;
            if (OnUsernameReceived == null)
                throw new InvalidOperationException("No handler for OnUsernameReceived event.");
            else
                id = OnUsernameReceived(request.Name);

            return new Response { Id = id };
        }
    }
}